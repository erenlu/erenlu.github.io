

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700;900&display=swap" 
  <link rel="apple-touch-icon" sizes="76x76" href="/img/sys/%E9%A3%9E%E8%88%B9.png">
  <link rel="icon" href="/img/sys/%E9%A3%9E%E8%88%B9.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#000000">
  <meta name="author" content="Eren">
  <meta name="keywords" content="life,technology,播客,极简主义,Minimalism,学习,生活,科技,编程,嵌入式,蓝牙,室内定位,博客,Hexo,工具/资源,教程,分享,推荐,娱乐,摄影,文学">
  
    <meta name="description" content="最近在做导师手下的蓝牙 Mesh 组网项目，在此粗浅地记录蓝牙 Mesh 组网相关知识。">
<meta property="og:type" content="article">
<meta property="og:title" content="浅谈蓝牙 Mesh 组网技术">
<meta property="og:url" content="https://erenship.com/posts/63c7.html">
<meta property="og:site_name" content="Eren の 宇宙船">
<meta property="og:description" content="最近在做导师手下的蓝牙 Mesh 组网项目，在此粗浅地记录蓝牙 Mesh 组网相关知识。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/202009122330235.png">
<meta property="article:published_time" content="2020-09-12T06:33:21.000Z">
<meta property="article:modified_time" content="2020-09-28T00:43:34.000Z">
<meta property="article:author" content="Eren">
<meta property="article:tag" content="life,technology,播客,极简主义,Minimalism,学习,生活,科技,编程,嵌入式,蓝牙,室内定位,博客,Hexo,工具&#x2F;资源,教程,分享,推荐,娱乐,摄影,文学">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/202009122330235.png">
  
  
  
  <title>浅谈蓝牙 Mesh 组网技术 - Eren の 宇宙船</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/iconfont_500px/iconfont.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"erenship.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":"UA-176568792-1","gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"jauMdl8cvkseHUDG81ucNoej-MdYXbMMI","app_key":"T7zcEHNEYGyPVNB8BW5A16TH","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript('https://www.google-analytics.com/analytics.js', function() {
          window.ga = window.ga || function() { (ga.q = ga.q || []).push(arguments) };
          ga.l = +new Date;
          ga('create', 'UA-176568792-1', 'auto');
          ga('send', 'pageview');
        });
      }
    </script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Eren の 宇宙船</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/About/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>朋友</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/202009122330235.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.5)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="浅谈蓝牙 Mesh 组网技术"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2020-09-12 14:33" pubdate>
          2020年9月12日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          19 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">浅谈蓝牙 Mesh 组网技术</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2020年9月28日 早上
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <div class="note note-success">
            <p>本文主要根据蓝牙兴趣联盟（SIG）以及其官方微信公众号关于蓝牙 Mesh 组网的相关博文进行梳理，旨在对蓝牙 Mesh 组网技术有一个初步的认识。</p>
          </div>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>蓝牙 Mesh 脱胎于 CSR 倡导的私有协议- CSR Mesh，该技术诞生于 2014 年。</p>
<p>蓝牙技术联盟（SIG）于去年 7 月 19 日正式宣布，蓝牙技术开始全面支持 Mesh 网状网络。<strong>蓝牙 Mesh 组网是一种组网技术</strong>，蓝牙 4.0 以上支持低功耗蓝牙的芯片都支持。全新的 Mesh 功能提供设备间多对多传输，并特别提高构建大范围网络覆盖的通信能力，适用于楼宇自动化、无线传感器网络等需要让数以万计个设备在可靠、安全的环境下传输的物联网解决方案。如今，蓝牙适用的范围已经逐渐拓展到所有物联网边缘场景：“蓝牙增强速率技术（BR &#x2F; EDR）” 的应用从无线耳机发展到鼠标键盘；“蓝牙低功耗技术” 应用于手表、手环，发掘了可穿戴市场；而“蓝牙 Mesh 组网技术”则瞄准了整个（边缘域）物联网市场，包括消费领域和工业领域<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="[蓝牙 Mesh 简介](http://www.xmamiga.com/3433/)">[1]</span></a></sup>。</p>
<iframe width="560" height="315" src="https://player.vimeo.com/video/225874947" frameborder="0" allowfullscreen></iframe>

<h2 id="低功耗蓝牙（BLE）"><a href="#低功耗蓝牙（BLE）" class="headerlink" title="低功耗蓝牙（BLE）"></a>低功耗蓝牙（BLE）</h2><p>要讨论蓝牙 Mesh 组网技术就必须先说明低功耗蓝牙（Bluetooth Low Energy, BLE），因为蓝牙 Mesh 网络使用、并且依赖于低功耗蓝牙。<strong>低功耗蓝牙技术是蓝牙 Mesh 使用的无线通信协议栈<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="[An Intro to Bluetooth Mesh Part 1](https://www.bluetooth.com/blog/an-intro-to-bluetooth-mesh-part1/)">[2]</span></a></sup>。</strong></p>
<p>首先蓝牙是一种短距离通信的无线电技术。其特点为：</p>
<ul>
<li>分散式网络结构；</li>
<li>点对点或多点通信；</li>
<li>快跳频和短包技术；</li>
<li>工作在2.4GHz ISM 频段（Industrial Scientific Medical Band）；</li>
<li>时分全双工传输。</li>
</ul>
<p>低功耗蓝牙泛指蓝牙 4.0 或更高的模块，蓝牙低功耗技术是一种低成本、短距离、可互操作的无线技术通信技术，工作在免许可的2.4GHz ISM 射频频段。相比于传统蓝牙（Classic Bluetooth，BT），低功耗蓝牙拥有更低的功耗，更远的传输距离，以及可以实现 AOA 室内定位。现如今的电子设备基本都配备 BLE 4.0 以上的蓝牙模块。例如我们的无线耳机，智能手环以及各种红黄蓝绿的单车等设备都使用到了低功耗蓝牙模块进行通信。</p>
<p><strong>BLE 低功耗蓝牙和传统蓝牙有以下5大区别<sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" aria-label="[The Fundamental Concepts of Bluetooth Mesh Networking Part 1](https://www.bluetooth.com/blog/the-fundamental-concepts-of-bluetooth-mesh-networking-part-1/)">[5]</span></a></sup>：</strong></p>
<ol>
<li>低功耗蓝牙的发送和接受任务会以最快的速度完成，完成之后蓝牙 BLE 会暂停发射无线（但是还是会接受），等待下一次连接再激活；传统蓝牙是持续保持连接；</li>
<li>低功耗蓝牙的广播信道（为保证网络不互相干扰而划分）仅有 3 个；传统蓝牙是 32 个；</li>
<li>低功耗蓝牙“完成”一次连接(即扫描其它设备、建立链路、发送数据、认证和适当地结束)只需 3ms；传统蓝牙完成相同的连接周期需要数百毫秒；</li>
<li>低功耗蓝牙使用非常短的数据包，多应用于实时性要求比较高，但是数据速率比较低的产品，遥控类的如键盘，遥控鼠标，传感设备的数据发送，如心跳带，血压计，温度传感器等；传统蓝牙使用的数据包长度较长，可用于数据量比较大的传输，如语音，音乐，较高数据量传输等；</li>
<li>低功耗蓝牙无功率级别，一般发送功率在 +4dBm，一般在空旷距离，达到 70m 的传输距离；传统蓝牙有3个功率级别，Class1，Class2，Class3，分别支持 100m，10m，1m 的传输距离。</li>
</ol>
<p>蓝牙低能耗架构共有两种芯片构成：单模芯片和双模芯片。蓝牙单模芯片可以和其它单模芯片及双模芯片通信，此时后者需要使用自身架构中的蓝牙低能耗技术部分进行收发数据。双模芯片也能与标准蓝牙技术及使用传统蓝牙架构的其它双模芯片通信。</p>
<h2 id="蓝牙-Mesh-组网"><a href="#蓝牙-Mesh-组网" class="headerlink" title="蓝牙 Mesh 组网"></a>蓝牙 Mesh 组网</h2><div class="note note-danger">
            <p>蓝牙 Mesh 技术并非无线通信技术，而是一种网络（组网）的技术，用于构建 “多对多通信连接” 的网络。</p>
          </div>

<p>简单来说，蓝牙 Mesh 组网就是将众多的蓝牙设备互相连接，进而组成一个网络。各个蓝牙设备在网络中被称为节点（某些关键节点被称为网关）。各节点之间能够互相进行通信。</p>
<p><strong>蓝牙 Mesh 能让我们建立无线设备之间的“多对多”（m:m）关系</strong>。此外，设备能够将数据中继到不在初始设备直接无线电覆盖范围内的其他设备。这样，Mesh 网络就能够跨越非常大的物理区域，并包含大量设备。</p>
<blockquote>
<p>The new mesh capability enables many-to-many (m:m) device communications and is optimized for creating large-scale device networks. It is ideally suited for building automation, sensor networks, and other IoT solutions where tens, hundreds, or thousands of devices need to reliably and securely communicate with one another<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="[An Intro to Bluetooth Mesh Part 1](https://www.bluetooth.com/blog/an-intro-to-bluetooth-mesh-part1/)">[2]</span></a></sup>.</p>
<p>新的网状功能可实现多对多 (m:m) 设备通信，并为创建大规模设备网络进行了优化。它非常适合楼宇自动化、传感器网络和其他物联网解决方案，在这些方案中，几十台、几百台或几千台设备需要可靠和安全地相互通信。</p>
</blockquote>
<p>对于满足日益普及的各种通信需求，Mesh 拓扑结构能提供最佳的方式，因此蓝牙 Mesh 网络应运而生，典型的应用包括楼宇自动化和传感器网络等。这些通信需求包括：</p>
<ul>
<li>覆盖面积广</li>
<li>“直联互通性”</li>
<li>监测和控制大量设备的能力</li>
<li>经优化的、低功耗的</li>
<li>有效利用无线电资源，有可扩展性</li>
<li>与当前市场上的智能手机、平板电脑和个人电脑产品兼容</li>
<li>符合行业标准，具有政府级安全性</li>
</ul>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li><p><strong>以消息为中心的通信</strong></p>
<p><strong>蓝牙 Mesh 网络使用发布&#x2F;订阅 (publish&#x2F;subscribe)消息系统</strong>。</p>
<p>设备可以将消息发送至特定地址，这些地址的名称和含义与用户能够理解的高级概念相对应，如“花园灯”(Garden Lights)。这被称为“发布”（publishing）。</p>
<p>设备经配置后，可接收由其他设备发送到特定地址的消息。这被称为“订阅” (subscribing) 。</p>
<p>当设备向特定地址发布消息时，订阅该地址的所有其他设备将收到该地址的副本，对其进行处理，并以某种方式作出回应。</p>
<p>想象一下花园里安装的一套户外灯, 每盏灯都已经过配置，以便其订阅“花园灯”消息。现在，想像一个蓝牙Mesh 电灯开关向“花园灯”地址发送了 “开” 的消息。没错，花园里的所有灯都会收到 “ON” 消息，并做出开灯的回应。<img src="https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/20200913131151.png" srcset="/img/loading.gif" lazyload alt="Snipaste_2020-09-13_13-11-08"></p>
</li>
<li><p><strong>消息和设备状态</strong></p>
<p><strong>“状态” (state) 是蓝牙 Mesh 网络中的一个关键概念</strong>。蓝牙 Mesh 网络中的每台设备都具有一组独立的状态值，表示设备的某些状态。在花园灯的示例中，每盏灯都有一个状态值，表示设备当前是处于打开或关闭状态。通过发布一类在定义上意味着能够回应“开”或“关”状态值的消息，来改变状态值，蓝牙 Mesh 电灯开关就能对灯泡进行控制。更改状态值会修改设备本身的物理状况，例如打开或关闭设备。</p>
<p>消息、状态、以及这些和其他概念相关的设备行为已被定义在规格中，称为“模型”（modules）。模型由蓝牙Mesh 设备实施。</p>
</li>
<li><p><strong>中继</strong></p>
<p><strong>得益于 Mesh 网络，设备可以在非常广阔的区域中安装，同时彼此之间保持通信。</strong>想象一下购物中心、机场或办公大楼的占地空间有多广阔。因为存在墙壁和其他物理上的障碍物，楼宇中的设备可能无法与安装在同一楼宇远侧的设备、或临近楼宇中的设备建立直接的无线连接。而蓝牙 Mesh 网络则能够将网络中的某些设备指定为“中继设备”，进而解决这一难题。</p>
<p><strong>中继设备能够转发从其他设备接收到的消息。</strong>在转发消息时，它们能够与位于初始消息发布设备无线范围以外的设备进行通信。消息可多次被中继，每一次中继即为一 “跳”，最多可进行 127 跳，足以在一片广阔的物理区域中进行消息传输。</p>
<p><img src="https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/20200913125504.png" srcset="/img/loading.gif" lazyload alt="Snipaste_2020-09-13_12-54-27"></p>
</li>
<li><p><strong>管理型网络泛洪（Managed Flooding）</strong></p>
<p><strong>蓝牙 Mesh 网络采用一种称为 “网络泛洪（flooding）” 的方式来发布和中继消息。</strong>这意味着消息不会通过某一进程进行路由, 也不会沿着由一系列特定设备构成的特定路径来进行传输。相反，传输范围内的所有设备都会接收消息，负责中继的设备能将消息转发至其传输范围内的所有其他设备。</p>
<p><strong>网络泛洪的优势在于无需特定设备专门扮演集中式路由器的角色。</strong>集中式路由器一旦发生故障，就可能会导致整个网络无法运行。没有特定的路由也可能对网络造成灾难性的影响，但这种情况也可以通过在 Mesh 网络中采用网络泛洪的方法来避免。</p>
<p>网络泛洪的方式也意味着消息一般能够通过多重路径到达其目的地。<strong>这就构建了一个相当可靠的网络。</strong></p>
<ul>
<li><p><strong>优化 Mesh 网络</strong></p>
<p><strong>蓝牙 Mesh 网络也采取了一系列措施，支持采用网络泛洪的方式，同时优化每台设备、甚至整体网络的能耗。</strong></p>
<p>所有数据包都包含一个称为 TTL 的字段，它可用于限制消息中继的跳数。由设备间歇性发送的心跳消息中包含的信息，能够让网络了解其拓扑结构、以及传到其他每台设备之间的跳数。这能够让设备将 TTL 设置为最佳值，从而避免不必要的中继操作。</p>
<p>每台设备都包含消息缓存，以确定自身是否已经中继过该消息。如果是，则会立即丢弃该消息，从而避免上层堆栈进行不必要的处理。</p>
</li>
</ul>
<p>功率非常受限的设备（例如由小型电池持续供电多年的传感器）可能被指定为 “低功耗节点”。<strong>低功耗节点能够与一个或多个被指定为 “friends” 的设备协同工作。</strong>Friends 并非功率受限，它可以作为低功耗节点，存储寻址到这一低功耗节点的消息，并且只有在低功耗节点需要时才传送消息。<strong>低功耗节点和 “friends” 之间的关系理所当然就称为 “friendship”。</strong></p>
</li>
</ul>
<h3 id="基本术语"><a href="#基本术语" class="headerlink" title="基本术语"></a>基本术语</h3><ul>
<li><p><strong>节点（Node）</strong></p>
<p><strong>蓝牙 Mesh 网络中的这些设备被称为节点 (node) 。</strong>每个节点都能发送和接收消息。信息能够在节点之间被中继，从而让消息传输至比无线电波正常传输距离更远的位置。</p>
</li>
<li><p><strong>元素（Elements）</strong></p>
<p>一些节点（如传感器）的电池有可能会被耗尽，而其他节点（如照明设备、制造机械和安防摄像机）则会通过主电网来获取电力。一些节点的处理能力会高于其他节点。这些节点在 Mesh 网络中可承担更为复杂的任务，扮演不同的角色，表现出 <strong>以下四个节点特征（Features）</strong>：</p>
<div class="note note-primary">
            <p><strong>低功耗 (Low-Power) 特性</strong></p><p>功率受限的节点可能会利用低功耗特性来减少无线电接通时间并节省功耗。同时低功耗节点（LPN）可以与friend 节点协同工作。</p>
          </div>

<div class="note note-success">
            <p><strong>Friend 特性</strong></p><p>功率不受限的节点很适合作为 friend 节点。Friend 节点能够存储发往低功耗节点（LPN）的消息和安全更新；当低功耗节点需要时再将存储的信息传输至低功耗节点。</p>
          </div>

<div class="note note-warning">
            <p><strong>中继 (Relay) 特性</strong></p><p>中继节点能够接收和转发消息，通过消息在节点之间的中继，实现更大规模的网络。节点是否能够具备这一特性取决于其电源和计算能力。</p>
          </div>

<div class="note note-info">
            <p><strong>代理 (Proxy) 特性</strong></p><p>代理节点能够实现 GATT 和蓝牙 Mesh 节点之间的 Mesh 消息发送与接收。承担这一角色的节点需要固定的电源和计算资源。</p>
          </div>

<p><img src="https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/20200913134652.png" srcset="/img/loading.gif" lazyload alt="Snipaste_2020-09-13_13-46-07"></p>
<p><strong>一些节点的复杂性高于其他节点，由多个称为元素（Element）的独立部分组成。</strong>每个节点至少拥有一个元素，称为主元素（Primary Element），同时还可能包含其他多个元素。</p>
<p><img src="https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/20200913132902.png" srcset="/img/loading.gif" lazyload alt="Snipaste_2020-09-13_13-28-21"></p>
<p><strong>元素由定义节点功能和元素条件的实体组成。</strong>例如，一个灯泡内有一个元素, 并具有两种功能：</p>
<div class="note note-danger">
            <p><strong>节点 &#x3D; 灯泡</strong></p><p><strong>一个元素 &#x3D; 主元素</strong></p><p><strong>节点功能：</strong></p><p>​           - 开&#x2F;关</p><p>​           - 亮度</p><p><strong>元素条件&#x2F;状态：</strong></p><p>​           - “开”或“关”</p><p>​           - 0 – 10 (亮度等级)</p>
          </div>

<p>节点中的每个元素都有一个唯一的地址，称为单播地址（unicast address），使每个元素都有址可寻。</p>
</li>
<li><p><strong>模型 (Model) 和状态 (State）</strong></p>
<p>无论节点位于制造厂房、酒店、办公楼、还是商业园区的网络中，节点的基本功能都由模型（Model）来定义和实施。模型位于元素内，元素必须具有至少一个模型。<strong>模型能够定义并实施节点的功能和行为，而状态 (State) 能够定义元素的条件</strong>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/20200913133144.png" srcset="/img/loading.gif" lazyload alt="Snipaste_2020-09-13_13-31-29"></p>
<p>以灯泡为例，该模型的功能是开关和调节亮度。相关的状态分别为 “开” &#x2F; “关” 和 0-10：</p>
<div class="note note-danger">
            <p><strong>模型 (节点功能)</strong></p><p>​       <strong>1. 开&#x2F;关</strong></p><p>​          状态 -&gt; “开” 或 “关”</p><p>​       <strong>2. 亮度 (0-10)</strong></p><p>​          状态 -&gt; 0-10</p>
          </div>

<p>蓝牙 Mesh 支持复合状态，即由两个或多个值组成的状态。变色灯就是这样的一个例子，色调可以不受颜色饱和度或亮度的局限而改变。</p>
<p><strong>“绑定状态” (Bound State) 这一术语的定义源自一种状态的变化导致另一状态变化的情况。</strong>级别状态和开&#x2F;关状态通常就相互绑定。如果级别从0变为1，则“开&#x2F;关”的状态也从“关”变为“开”。</p>
<p>每个模型都有唯一的标识符。蓝牙技术联盟采用 16 位的模型，而供应商采用 32 位（其中包含蓝牙技术联盟指定的16位公司标识符以及16位供应商指定的模型标识符）。<strong>这确保了每个模型的地址都独一无二并且能确定被寻址到。</strong></p>
<p><strong>蓝牙 Mesh 网络可借助消息，通过客户端 - 服务器架构进行通信。</strong>服务器的功能是暴露元素的状态。最简单的状态之一是二进制开关，其中状态为“开”或“关”。简单的服务器模型是通用开&#x2F;关服务器模型 (Generic On&#x2F;Off Server Model) ，其中包含表示开关开启或关闭的状态。</p>
<p>客户端可对状态进行访问，请求、更改或使用服务器的状态。举例来说，一个简单的客户端模型就是通用开&#x2F;关客户端模型（Generic On&#x2F;Off Client Model）（二进制开关）。通用开&#x2F;关客户端模型通过发送消息来控制通用开&#x2F;关服务器模型。例如，客户端可利用这一机制开启或关闭指示灯。</p>
</li>
</ul>
<h3 id="协议栈"><a href="#协议栈" class="headerlink" title="协议栈"></a>协议栈</h3><p><strong>蓝牙 Mesh 网络引入了全新的协议栈</strong>。这一协议栈建立在低功耗蓝牙技术之上。下图描绘了<strong>协议栈的层级</strong>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/20200913134823.png" srcset="/img/loading.gif" lazyload alt="Snipaste_2020-09-13_13-48-12"></p>
<ul>
<li><strong>承载层（bearer layer）：</strong>承载层定义了如何使用底层低功耗堆栈传输 PDU。目前定义了两个承载层：广播承载层（Advertising Bearer）和 GATT 承载层。</li>
<li><strong>网络层（network layer）</strong>：网络层定义了各种消息地址类型和网络消息格式。中继和代理行为通过网络层实施。</li>
<li><strong>底层传输层（lower transport layer）：</strong>在需要之时，底层传输层能够处理 PDU 的分段和重组。</li>
<li><strong>上层传输层（upper transport layer）</strong>：负责对接入层进出的应用数据进行加密、解密和认证。它还负责称为 “传输控制消息”（transport control messages）这一特殊的消息，包括与 “friendship” 相关的心跳和消息。</li>
<li><strong>接入层（access layer）：</strong>负责应用数据的格式、定义并控制上层传输层中执行的加密和解密过程，并在将数据转发到协议栈之前，验证接收到的数据是否适用于正确的网络和应用。</li>
<li><strong>基础模型（foundation models）：</strong>基础模型层负责实现与 Mesh 网络配置和管理相关的模型。</li>
<li><strong>模型（models）：</strong>模型层与模型等的实施、以及诸如行为、消息、状态等的实施有关。</li>
</ul>
<p>节点（如照明装置、温控设备、制造设备和电动门）是蓝牙 Mesh 网络中能够发送、接收或中继消息的设备。消息（message）用于在节点之间传输数据，地址（address）用于定义消息源（source）地址和目的（destination）地址。</p>
<h3 id="地址（Address）"><a href="#地址（Address）" class="headerlink" title="地址（Address）"></a><strong>地址（Address）</strong></h3><p><strong>地址有四种类型，其中的三类用于消息的传送：单播（unicast）、虚拟（virtual）和群组（group）地址。第四种被称为未分配（unassigned）地址。</strong>地址长度为16位，并按下述定义进行编码。</p>
<p><img src="https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/20200913135kk700.webp" srcset="/img/loading.gif" lazyload alt="640"></p>
<div class="note note-primary">
            <p>  <strong>未分配地址（Unassigned Address）</strong></p><p>未经配置的元素或未被指定地址的元素拥有的就是未分配地址。鉴于这些元素没有唯一的地址，<strong>它们不会用于消息的传送。</strong></p>
          </div>

<div class="note note-secondary">
            <p>  <strong>单播地址（Unicast Address）</strong></p><p>在“启动配置”（provisioning）期间，启动配置设备（provisioner）会在网络节点的生命周期内为节点中的每个元素分配一个单播地址。单播地址可能出现在消息的源地址字段或目的地址字段中。<strong>发送到单播地址的消息只能由一个元素进行处理。</strong></p>
          </div>

<div class="note note-success">
            <p>  <strong>虚拟地址（Virtual Address）</strong></p><p><strong>虚拟地址是与特定的 UUID 标签相关联的一组元素</strong>；这些地址可能会被发布或订阅。UUID 标签是与多个来自一个或多个节点的元素相关联的 128 位值。</p><p>对于虚拟地址，15 和 14 位分别设置为 1 和 0；13 – 0 位被设置为散列值（hash value）（提供 16384 个散列值）。散列（hash）来自于 Label UUID。使用订阅元素（subscribing element）来检查完整的 128 位 UUID 是十分低效的，特别当 UUID 跨越多个消息段时更为低效。<strong>散列值提供了一种更为有效的方式来确定哪些消息被发送至哪些元素。</strong></p>
          </div>

<div class="note note-info">
            <p><strong>群组地址（Group Address）</strong></p><p><strong>群组地址是蓝牙 Mesh 网络中的另一种多播地址（multicast address）</strong>，它通常代表一个或多个节点中的多个元素，包含两种类型：</p><ul><li>动态分配的地址（Dynamically Assigned） -&gt; 0xC000-0xFEFF</li><li>固定地址（Fixed Address） –  由蓝牙技术联盟分配，分为五段。</li></ul>
          </div>

<h3 id="消息（Message）"><a href="#消息（Message）" class="headerlink" title="消息（Message）"></a>消息（Message）</h3><p><strong>蓝牙 Mesh 网络通过消息进行通信。消息可以分为控制消息和接入消息。</strong></p>
<div class="note note-warning">
            <p><strong>控制消息（Control Message）：</strong>与蓝牙 Mesh 网络操作有关的消息，例如心跳（heartbeat）和 friend 的请求消息。</p><p><strong>接入消息（Access Message）：</strong>该类消息允许客户端模型检索或设置服务器模型中的状态值，或被服务器用于报告状态值。</p>
          </div>

<p>模型可实施并定义节点的功能。<strong>元素是节点内唯一可被寻址的实体（节点中可包含一个或多个模型），并由状态（state）定义元素的状况变化</strong>。对于每个状态，都有一组服务器模型支持的消息。例如请求状态值或请求改变状态的客户端模型、以及发送状态或状态改变相关消息的服务器模型。</p>
<p><strong>接入消息分为两类：经确认的（acknowledged）和未经确认的（unacknowledged）</strong>。经确认的消息被发送至每个接收元素，并经其确认。响应通常为状态消息。对于未经确认的消息则不作出响应。<strong>例如蓝牙 Mesh 网络的状态消息就是一种未经确认的消息。</strong></p>
<h3 id="安全（Security）"><a href="#安全（Security）" class="headerlink" title="安全（Security）"></a>安全（Security）</h3><p><strong>所有蓝牙 Mesh 网络消息的安全保障都来自网络密钥（NetKey）和应用密钥（AppKey）对消息的加密和验证。</strong>NetKey 用于网络层通信。假设蓝牙 Mesh 网络没有子网，则该 Mesh 网络内的所有通信都使用相同的网络密钥。</p>
<p><strong>AppKey 用于应用程序的数据。</strong>网络中的一些节点具有特定应用，并且根据应用的需要对一些潜在敏感数据的访问进行限制。这些节点具有特定的 AppKey，并与特定应用相关联。会使用不同 AppKey 的领域通常包括安全（楼宇门禁、机房门禁和 CEO 办公室门禁）、照明（制造厂房、外部楼宇照明和人行道）和 HVAC 系统。</p>
<p>中继节点（relay node）（如灯泡或墙壁开关）通常具有有效的 NetKey，能够在网络内中继敏感性消息。然而，这些节点无法访问各种限制区域（如楼宇控制或 HVAC 系统）的特定 AppKey，，亦无法解密应用程序的数据。</p>
<h3 id="启动配置（Provisioning）"><a href="#启动配置（Provisioning）" class="headerlink" title="启动配置（Provisioning）"></a>启动配置（Provisioning）</h3><p>启动配置的全过程包括大概 5 个步骤<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="[蓝牙 Mesh 简介](http://www.xmamiga.com/3433/)">[1]</span></a></sup>, 分别是：</p>
<ul>
<li>Beaconing: 发送Beacon信号，告诉你我要配网, 这里使用的是新定义的 AD 广播包类型, Mesh AD；</li>
<li>Invitation: 配网者 Provisioner 听到了这个 Beacon 以后, 就发一个邀请, 用的就是配网邀请 PDU（Protocol Data Unit）；</li>
<li>Exchanging Public Keys: 交换公钥；</li>
<li>Authentication: 一个互动随机数的认证流程；</li>
<li>Distribution of the Provisioning Data: 认证完成, 从公钥和两个设备的私钥派生出 Session Key，后面的配网的信息交互的过程会用这个 Session key 来加密， 配网成功以后, 就会根据最后一步里面包含交换的 NetKey 来加密后面的数据交换</li>
</ul>
<h3 id="信息交换"><a href="#信息交换" class="headerlink" title="信息交换"></a>信息交换</h3><p><strong>蓝牙 Mesh 网络使用发布&#x2F;订阅 (publish&#x2F;subscribe) 模型来进行消息传输。</strong>生成消息的节点会发布消息。需要接收消息的节点会订阅它们所需的地址。消息可被发布至单播、群组或虚拟地址。</p>
<p><strong>消息可以作为对其他消息的回复而发送，也可以作为非请求消息（unsolicited messages）被发送。</strong>当模型发送回复消息时，使用消息始发处的源地址作为目标地址。发送非请求消息时，模型将使用模型的发布地址作为目标地址。节点中的每个模型都有一个发布地址。</p>
<p>接收消息时，节点内模型（节点中可能存在多个模型）中的每个实例均可通过订阅方式从一个或多个群组或虚拟地址接收消息。</p>
<p>订阅消息的模型使用模型的订阅列表来定义用于接收消息的有效地址。当模型接收到消息时，模型将检查其订阅列表。<strong>当订阅列表上的地址设置为模型的元素单播地址或属于该节点的固定群组地址时，则视为一个匹配（match）。</strong>下图表示了接入消息的有效源地址和目标地址。</p>
<p><img src="https://cdn.jsdelivr.net/gh/erenlu/PicGo//img/20200913141452.webp" srcset="/img/loading.gif" lazyload alt="640 (1)"></p>
<p>蓝牙 Mesh 实体发布各种节点的状态时，无论其与发送数据的节点位置距离远近,整个蓝牙 Mesh 网络中的系统均可订阅该数据。<strong>这就实现了网络一端的设备可通过低功耗无线消息与设施中的其他的管理者进行对话，而不受距离限制。</strong></p>
<h2 id="进阶篇"><a href="#进阶篇" class="headerlink" title="进阶篇"></a>进阶篇</h2><div class="note note-success">
            <ul><li><p><a target="_blank" rel="noopener" href="https://www.bluetooth.com/blog/bluetooth-mesh-networking-series-friendship/">Bluetooth Mesh Networking: Friendship</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzA4MTg3MTg2Mg==&mid=2651236984&idx=3&sn=a9ed5551ba9703a9ee93ed03a8459de5&chksm=847c5ce1b30bd5f71cca73920a9b1808d16372d8076ebcd226ece022f98a79d2eb7e331ffa21&scene=21#wechat_redirect">蓝牙mesh网络 （ 友谊篇 ）</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzA4MTg3MTg2Mg==&mid=2651236997&idx=1&sn=99975f2b3930e36a2e8a040beed7cb75&chksm=847c5c1cb30bd50acc8745f37b2fa733171e2757529ac386cea58e6d2d62c326691e70888469&scene=21#wechat_redirect">蓝牙mesh网络（设备管理）</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzA4MTg3MTg2Mg==&mid=2651237018&idx=1&sn=87b36c6b36ead981e8b89903bcb0880f&chksm=847c5c03b30bd51596d772121c1454393a5dc3b2b03fc41a0eb590847cc8c4dde9b89c0a6f0a&scene=21#wechat_redirect">蓝牙mesh网络（安全性概览）</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/aS16lAPmy4IRUgmcvqYe8g">蓝牙mesh网络（启动配置Part1）</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/yaixqoR5s87c3uw5Uw7ccA">蓝牙mesh网络（启动配置Part2）</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/o2oTlXjzcbr0bDEU89uGuA">潜入蓝牙mesh海洋深处</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/4g9dvRy3eJ9ToyMFWiDScQ">蓝牙mesh | “三大法宝“让你的网络无懈可击</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/cFn3xQ4X3e87viqyDhJM_Q">蓝牙mesh网络：走进数据包</a></p></li></ul>
          </div>

<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>虽然蓝牙 Mesh 组网技术的协议早已提出，但个人感觉相关 SDK 开发包仍不太成熟。不过未来应用场景仍然是可以畅想的。</p>
<p>正如蓝牙兴趣联盟所畅想的一样：</p>
<blockquote>
<p>我们期待蓝牙 Mesh 网络广泛应用于各行各业和各种应用，预计最初会从<strong>楼宇自动化、商业照明和传感器网络</strong>等应用开始。尤其令人兴奋的是<strong>蓝牙 Mesh 网络在商业照明方面的应用</strong>。试想一下，有了正确的固件，照明系统能实现的就不仅是无线灯光控制，还能够成为楼宇中各种蓝牙服务的平台，如物资跟踪和定位服务！</p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a target="_blank" rel="noopener" href="http://www.xmamiga.com/3433/">蓝牙 Mesh 简介</a>
<a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://www.bluetooth.com/blog/an-intro-to-bluetooth-mesh-part1/">An Intro to Bluetooth Mesh Part 1</a>
<a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://www.bluetooth.com/blog/an-intro-to-bluetooth-mesh-part2/">An Intro to Bluetooth Mesh Part 2</a>
<a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://www.bluetooth.com/blog/introducing-bluetooth-mesh-networking/">Introducing Bluetooth Mesh Networking</a>
<a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://www.bluetooth.com/blog/the-fundamental-concepts-of-bluetooth-mesh-networking-part-1/">The Fundamental Concepts of Bluetooth Mesh Networking Part 1</a>
<a href="#fnref:5" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:6" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/48722431/answer/599493049">BLE和传统蓝牙有什么区别，各有什么优缺点？</a>
<a href="#fnref:6" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:7" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhanghuaishu0/article/details/78770486">蓝牙mesh — 解密蓝牙mesh系列文章汇总</a>
<a href="#fnref:7" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%AD%A6%E4%B9%A0%E6%B4%BE/" class="category-chain-item">学习派</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>浅谈蓝牙 Mesh 组网技术</div>
      <div>https://erenship.com/posts/63c7.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Eren</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2020年9月12日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/13b8.html" title="把你的名字送上火星">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">把你的名字送上火星</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/6591.html" title="打球手歪后，我却要安利「蜜雪冰城」">
                        <span class="hidden-mobile">打球手歪后，我却要安利「蜜雪冰城」</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://lib.baomitu.com/waline/2.14.1/waline.min.css')
      Fluid.utils.createScript('https://lib.baomitu.com/waline/2.14.1/waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://waline-8z7beifxu-erenlu.vercel.app","path":"window.location.pathname","meta":["nick","mail","link"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
        
    </div>
  
  
  
  

    <div class="text-center py-1">   
    <div>
      <span>Copyright © 2020-2023</span></a>
      <br>
      <a href="https://erenship.com/" target="_blank" rel="nofollow noopener">
       <span>Eren の 宇宙船 </span></a>  <br>
    </div>


</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
